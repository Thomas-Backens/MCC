(() => {
var exports = {};
exports.id = "pages/api/hymn";
exports.ids = ["pages/api/hymn"];
exports.modules = {

/***/ "./src/Utils/mongodb.js":
/*!******************************!*\
  !*** ./src/Utils/mongodb.js ***!
  \******************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const {
  MongoClient
} = __webpack_require__(/*! mongodb */ "mongodb");

const uri = "mongodb+srv://mongomastercluster:Homeschool20035@cluster0.yp2ivel.mongodb.net/?retryWrites=true&w=majority";

const setLogs = async (hymnId, newLogs) => {
  const client = new MongoClient(uri);

  try {
    await client.connect();
    const setLog = await client.db("AllHymns").collection("Hymns").updateOne({
      _id: hymnId
    }, {
      $set: {
        logs: newLogs
      }
    });
    console.log(setLog);
  } catch (e) {
    console.error(e);
  } finally {
    await client.close();
  }
}; // setLogs(17, [{ logged: "11/08/22", by: "Thomas Backens" }]).catch(
//   console.error
// );


const getAllHymns = async () => {
  const client = new MongoClient(uri);
  let result = {};

  try {
    await client.connect();
    const list = client.db("AllHymns").collection("Hymns").find({
      _id: {
        $gte: 0
      }
    });
    result = await list.toArray();
  } catch (e) {
    console.error(e);
  } finally {
    await client.close();
  }

  return result;
};

const addHymn = async newHymn => {
  const client = new MongoClient(uri);
  let result = {};

  try {
    await client.connect();
    const insertedHymn = client.db("AllHymns").collection("Hymns").insertOne(newHymn);
    result = await insertedHymn;

    if (result.insertedId) {
      result = [{
        number: newHymn._id,
        name: newHymn.name,
        logs: newHymn.logs
      }];
    }
  } catch (e) {
    console.error(e);
  } finally {
    await client.close();
  }

  return result;
}; // addHymn({
//   _id: 489,
//   name: "Glory to His Name",
//   logs: [{ logged: "02/17/21", by: "Thomas Backens" }],
// }).catch(console.error);


const editHymn = async (hymnId, newId, newName) => {
  const client = new MongoClient(uri);
  let result = {};

  try {
    await client.connect();
    console.log(hymnId, newId, newName);
    const oldHymn = await client.db("AllHymns").collection("Hymns").findOne({
      _id: hymnId
    });
    console.log(oldHymn);
    oldHymn._id = newId;
    oldHymn.name = newName;
    client.db("AllHymns").collection("Hymns").insertOne(oldHymn);
    await client.db("AllHymns").collection("Hymns").deleteOne({
      _id: hymnId
    });
    const newHymns = getAllHymns().catch(console.error);
    result = await newHymns;
  } catch (e) {
    console.error(e);
  } finally {
    await client.close();
  }

  return result;
};

const addLog = async (hymnId, newLog) => {
  const client = new MongoClient(uri);
  let result = {};

  try {
    await client.connect();
    const hymn = await client.db("AllHymns").collection("Hymns").findOne({
      _id: hymnId
    });
    let newLogs = await hymn.logs;

    for (let i = 0; i < newLogs.length; i++) {
      if (newLogs[i].logged === newLog.logs[0].logged) {
        return;
      }
    }

    newLogs.push(newLog.logs[0]);
    const insertedLog = await client.db("AllHymns").collection("Hymns").updateOne({
      _id: hymnId
    }, {
      $set: {
        logs: newLogs
      }
    });
    result = insertedLog;

    if (result.modifiedCount >= 1) {
      const newHymns = getAllHymns().catch(console.error);
      result = await newHymns;
    }
  } catch (e) {
    console.error(e);
  } finally {
    await client.close();
  }

  return result;
}; // addLog(17, { logs: [{ logged: "11/08/22", by: "kevin" }] }).catch(
//   console.error
// );


module.exports = {
  getAllHymns,
  addHymn,
  editHymn,
  addLog
};

/***/ }),

/***/ "./src/pages/api/hymn.js":
/*!*******************************!*\
  !*** ./src/pages/api/hymn.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* eslint-disable import/no-anonymous-default-export */
const mongoQuery = __webpack_require__(/*! ../../Utils/mongodb */ "./src/Utils/mongodb.js");

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (async (req, res) => {
  switch (req.method) {
    case "GET":
      try {
        const hymns = await mongoQuery.getAllHymns();
        res.status(200).json({
          hymns
        });
        break;
      } catch (err) {
        return res.status(500).json({
          message: err.message
        });
      }

    case "POST":
      try {
        const {
          name,
          number,
          log
        } = await req.body;

        if (name && number) {
          if (log.by) {
            const result = await mongoQuery.addHymn({
              _id: number,
              name: name,
              logs: [{
                logged: log.logged,
                by: log.by
              }]
            });
            console.log(result);
            return res.json(result[0]);
          } else {
            const result = await mongoQuery.addHymn({
              _id: number,
              name: name,
              logs: [{
                logged: log.logged,
                by: "Anonymous"
              }]
            });
            return res.json(result[0]);
          }
        }

        throw new Error("number required");
      } catch (err) {
        return res.status(500).json({
          message: err.message
        });
      }

    case "PUT":
      try {
        const {
          _id,
          logged,
          by
        } = await req.body;

        if (_id && logged) {
          if (by) {
            const result = await mongoQuery.addLog(_id, {
              logs: [{
                logged: logged,
                by: by
              }]
            });

            if (result === undefined) {
              return res.json([]);
            }

            return res.json(result);
          } else {
            const result = await mongoQuery.addLog(_id, {
              logs: [{
                logged: logged,
                by: "Anonymous"
              }]
            });

            if (result === undefined) {
              return res.json([]);
            }

            return res.json(result);
          }
        }

        throw new Error("log required");
      } catch (err) {
        return res.status(500).json({
          message: err.message
        });
      }

    case "PATCH":
      try {
        const {
          _id,
          newId,
          newName
        } = await req.body;

        if (_id) {
          const result = await mongoQuery.editHymn(_id, newId, newName);
          return res.json(result);
        }

        throw new Error("Id required");
      } catch (err) {
        return res.status(500).json({
          message: err.message
        });
      }

    default:
      return res.status(405).send("Method Not Allowed");
  }
});

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("mongodb");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("./src/pages/api/hymn.js"));
module.exports = __webpack_exports__;

})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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NkVELENBOUVEOzs7Ozs7Ozs7OztBQ0hBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWNjLy4vc3JjL1V0aWxzL21vbmdvZGIuanMiLCJ3ZWJwYWNrOi8vbWNjLy4vc3JjL3BhZ2VzL2FwaS9oeW1uLmpzIiwid2VicGFjazovL21jYy9leHRlcm5hbCBcIm1vbmdvZGJcIiJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IE1vbmdvQ2xpZW50IH0gPSByZXF1aXJlKFwibW9uZ29kYlwiKTtcclxuXHJcbmNvbnN0IHVyaSA9XHJcbiAgXCJtb25nb2RiK3NydjovL21vbmdvbWFzdGVyY2x1c3RlcjpIb21lc2Nob29sMjAwMzVAY2x1c3RlcjAueXAyaXZlbC5tb25nb2RiLm5ldC8/cmV0cnlXcml0ZXM9dHJ1ZSZ3PW1ham9yaXR5XCI7XHJcblxyXG5jb25zdCBzZXRMb2dzID0gYXN5bmMgKGh5bW5JZCwgbmV3TG9ncykgPT4ge1xyXG4gIGNvbnN0IGNsaWVudCA9IG5ldyBNb25nb0NsaWVudCh1cmkpO1xyXG5cclxuICB0cnkge1xyXG4gICAgYXdhaXQgY2xpZW50LmNvbm5lY3QoKTtcclxuXHJcbiAgICBjb25zdCBzZXRMb2cgPSBhd2FpdCBjbGllbnRcclxuICAgICAgLmRiKFwiQWxsSHltbnNcIilcclxuICAgICAgLmNvbGxlY3Rpb24oXCJIeW1uc1wiKVxyXG4gICAgICAudXBkYXRlT25lKHsgX2lkOiBoeW1uSWQgfSwgeyAkc2V0OiB7IGxvZ3M6IG5ld0xvZ3MgfSB9KTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhzZXRMb2cpO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgfSBmaW5hbGx5IHtcclxuICAgIGF3YWl0IGNsaWVudC5jbG9zZSgpO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIHNldExvZ3MoMTcsIFt7IGxvZ2dlZDogXCIxMS8wOC8yMlwiLCBieTogXCJUaG9tYXMgQmFja2Vuc1wiIH1dKS5jYXRjaChcclxuLy8gICBjb25zb2xlLmVycm9yXHJcbi8vICk7XHJcblxyXG5jb25zdCBnZXRBbGxIeW1ucyA9IGFzeW5jICgpID0+IHtcclxuICBjb25zdCBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQodXJpKTtcclxuICBsZXQgcmVzdWx0ID0ge307XHJcblxyXG4gIHRyeSB7XHJcbiAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG5cclxuICAgIGNvbnN0IGxpc3QgPSBjbGllbnRcclxuICAgICAgLmRiKFwiQWxsSHltbnNcIilcclxuICAgICAgLmNvbGxlY3Rpb24oXCJIeW1uc1wiKVxyXG4gICAgICAuZmluZCh7XHJcbiAgICAgICAgX2lkOiB7ICRndGU6IDAgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgcmVzdWx0ID0gYXdhaXQgbGlzdC50b0FycmF5KCk7XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgY29uc29sZS5lcnJvcihlKTtcclxuICB9IGZpbmFsbHkge1xyXG4gICAgYXdhaXQgY2xpZW50LmNsb3NlKCk7XHJcbiAgfVxyXG4gIHJldHVybiByZXN1bHQ7XHJcbn07XHJcblxyXG5jb25zdCBhZGRIeW1uID0gYXN5bmMgKG5ld0h5bW4pID0+IHtcclxuICBjb25zdCBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQodXJpKTtcclxuICBsZXQgcmVzdWx0ID0ge307XHJcblxyXG4gIHRyeSB7XHJcbiAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG5cclxuICAgIGNvbnN0IGluc2VydGVkSHltbiA9IGNsaWVudFxyXG4gICAgICAuZGIoXCJBbGxIeW1uc1wiKVxyXG4gICAgICAuY29sbGVjdGlvbihcIkh5bW5zXCIpXHJcbiAgICAgIC5pbnNlcnRPbmUobmV3SHltbik7XHJcblxyXG4gICAgcmVzdWx0ID0gYXdhaXQgaW5zZXJ0ZWRIeW1uO1xyXG4gICAgaWYgKHJlc3VsdC5pbnNlcnRlZElkKSB7XHJcbiAgICAgIHJlc3VsdCA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBudW1iZXI6IG5ld0h5bW4uX2lkLFxyXG4gICAgICAgICAgbmFtZTogbmV3SHltbi5uYW1lLFxyXG4gICAgICAgICAgbG9nczogbmV3SHltbi5sb2dzLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF07XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgY29uc29sZS5lcnJvcihlKTtcclxuICB9IGZpbmFsbHkge1xyXG4gICAgYXdhaXQgY2xpZW50LmNsb3NlKCk7XHJcbiAgfVxyXG4gIHJldHVybiByZXN1bHQ7XHJcbn07XHJcblxyXG4vLyBhZGRIeW1uKHtcclxuLy8gICBfaWQ6IDQ4OSxcclxuLy8gICBuYW1lOiBcIkdsb3J5IHRvIEhpcyBOYW1lXCIsXHJcbi8vICAgbG9nczogW3sgbG9nZ2VkOiBcIjAyLzE3LzIxXCIsIGJ5OiBcIlRob21hcyBCYWNrZW5zXCIgfV0sXHJcbi8vIH0pLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xyXG5cclxuY29uc3QgZWRpdEh5bW4gPSBhc3luYyAoaHltbklkLCBuZXdJZCwgbmV3TmFtZSkgPT4ge1xyXG4gIGNvbnN0IGNsaWVudCA9IG5ldyBNb25nb0NsaWVudCh1cmkpO1xyXG4gIGxldCByZXN1bHQgPSB7fTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IGNsaWVudC5jb25uZWN0KCk7XHJcblxyXG4gICAgY29uc29sZS5sb2coaHltbklkLCBuZXdJZCwgbmV3TmFtZSk7XHJcblxyXG4gICAgY29uc3Qgb2xkSHltbiA9IGF3YWl0IGNsaWVudFxyXG4gICAgICAuZGIoXCJBbGxIeW1uc1wiKVxyXG4gICAgICAuY29sbGVjdGlvbihcIkh5bW5zXCIpXHJcbiAgICAgIC5maW5kT25lKHsgX2lkOiBoeW1uSWQgfSk7XHJcblxyXG4gICAgY29uc29sZS5sb2cob2xkSHltbik7XHJcblxyXG4gICAgb2xkSHltbi5faWQgPSBuZXdJZDtcclxuICAgIG9sZEh5bW4ubmFtZSA9IG5ld05hbWU7XHJcblxyXG4gICAgY2xpZW50LmRiKFwiQWxsSHltbnNcIikuY29sbGVjdGlvbihcIkh5bW5zXCIpLmluc2VydE9uZShvbGRIeW1uKTtcclxuXHJcbiAgICBhd2FpdCBjbGllbnQuZGIoXCJBbGxIeW1uc1wiKS5jb2xsZWN0aW9uKFwiSHltbnNcIikuZGVsZXRlT25lKHsgX2lkOiBoeW1uSWQgfSk7XHJcblxyXG4gICAgY29uc3QgbmV3SHltbnMgPSBnZXRBbGxIeW1ucygpLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xyXG4gICAgcmVzdWx0ID0gYXdhaXQgbmV3SHltbnM7XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgY29uc29sZS5lcnJvcihlKTtcclxuICB9IGZpbmFsbHkge1xyXG4gICAgYXdhaXQgY2xpZW50LmNsb3NlKCk7XHJcbiAgfVxyXG4gIHJldHVybiByZXN1bHQ7XHJcbn07XHJcblxyXG5jb25zdCBhZGRMb2cgPSBhc3luYyAoaHltbklkLCBuZXdMb2cpID0+IHtcclxuICBjb25zdCBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQodXJpKTtcclxuICBsZXQgcmVzdWx0ID0ge307XHJcblxyXG4gIHRyeSB7XHJcbiAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG5cclxuICAgIGNvbnN0IGh5bW4gPSBhd2FpdCBjbGllbnRcclxuICAgICAgLmRiKFwiQWxsSHltbnNcIilcclxuICAgICAgLmNvbGxlY3Rpb24oXCJIeW1uc1wiKVxyXG4gICAgICAuZmluZE9uZSh7IF9pZDogaHltbklkIH0pO1xyXG5cclxuICAgIGxldCBuZXdMb2dzID0gYXdhaXQgaHltbi5sb2dzO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmV3TG9ncy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBpZiAobmV3TG9nc1tpXS5sb2dnZWQgPT09IG5ld0xvZy5sb2dzWzBdLmxvZ2dlZCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5ld0xvZ3MucHVzaChuZXdMb2cubG9nc1swXSk7XHJcblxyXG4gICAgY29uc3QgaW5zZXJ0ZWRMb2cgPSBhd2FpdCBjbGllbnRcclxuICAgICAgLmRiKFwiQWxsSHltbnNcIilcclxuICAgICAgLmNvbGxlY3Rpb24oXCJIeW1uc1wiKVxyXG4gICAgICAudXBkYXRlT25lKHsgX2lkOiBoeW1uSWQgfSwgeyAkc2V0OiB7IGxvZ3M6IG5ld0xvZ3MgfSB9KTtcclxuXHJcbiAgICByZXN1bHQgPSBpbnNlcnRlZExvZztcclxuICAgIGlmIChyZXN1bHQubW9kaWZpZWRDb3VudCA+PSAxKSB7XHJcbiAgICAgIGNvbnN0IG5ld0h5bW5zID0gZ2V0QWxsSHltbnMoKS5jYXRjaChjb25zb2xlLmVycm9yKTtcclxuICAgICAgcmVzdWx0ID0gYXdhaXQgbmV3SHltbnM7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgY29uc29sZS5lcnJvcihlKTtcclxuICB9IGZpbmFsbHkge1xyXG4gICAgYXdhaXQgY2xpZW50LmNsb3NlKCk7XHJcbiAgfVxyXG4gIHJldHVybiByZXN1bHQ7XHJcbn07XHJcblxyXG4vLyBhZGRMb2coMTcsIHsgbG9nczogW3sgbG9nZ2VkOiBcIjExLzA4LzIyXCIsIGJ5OiBcImtldmluXCIgfV0gfSkuY2F0Y2goXHJcbi8vICAgY29uc29sZS5lcnJvclxyXG4vLyApO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgZ2V0QWxsSHltbnMsXHJcbiAgYWRkSHltbixcclxuICBlZGl0SHltbixcclxuICBhZGRMb2csXHJcbn07XHJcbiIsIi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9uby1hbm9ueW1vdXMtZGVmYXVsdC1leHBvcnQgKi9cclxuY29uc3QgbW9uZ29RdWVyeSA9IHJlcXVpcmUoXCIuLi8uLi9VdGlscy9tb25nb2RiXCIpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgc3dpdGNoIChyZXEubWV0aG9kKSB7XHJcbiAgICBjYXNlIFwiR0VUXCI6XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgaHltbnMgPSBhd2FpdCBtb25nb1F1ZXJ5LmdldEFsbEh5bW5zKCk7XHJcbiAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBoeW1ucyB9KTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZXJyLm1lc3NhZ2UgfSk7XHJcbiAgICAgIH1cclxuICAgIGNhc2UgXCJQT1NUXCI6XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgeyBuYW1lLCBudW1iZXIsIGxvZyB9ID0gYXdhaXQgcmVxLmJvZHk7XHJcbiAgICAgICAgaWYgKG5hbWUgJiYgbnVtYmVyKSB7XHJcbiAgICAgICAgICBpZiAobG9nLmJ5KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vbmdvUXVlcnkuYWRkSHltbih7XHJcbiAgICAgICAgICAgICAgX2lkOiBudW1iZXIsXHJcbiAgICAgICAgICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgICAgICAgICBsb2dzOiBbeyBsb2dnZWQ6IGxvZy5sb2dnZWQsIGJ5OiBsb2cuYnkgfV0sXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLmpzb24ocmVzdWx0WzBdKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vbmdvUXVlcnkuYWRkSHltbih7XHJcbiAgICAgICAgICAgICAgX2lkOiBudW1iZXIsXHJcbiAgICAgICAgICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgICAgICAgICBsb2dzOiBbeyBsb2dnZWQ6IGxvZy5sb2dnZWQsIGJ5OiBcIkFub255bW91c1wiIH1dLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5qc29uKHJlc3VsdFswXSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIm51bWJlciByZXF1aXJlZFwiKTtcclxuICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZXJyLm1lc3NhZ2UgfSk7XHJcbiAgICAgIH1cclxuICAgIGNhc2UgXCJQVVRcIjpcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7IF9pZCwgbG9nZ2VkLCBieSB9ID0gYXdhaXQgcmVxLmJvZHk7XHJcbiAgICAgICAgaWYgKF9pZCAmJiBsb2dnZWQpIHtcclxuICAgICAgICAgIGlmIChieSkge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBtb25nb1F1ZXJ5LmFkZExvZyhfaWQsIHtcclxuICAgICAgICAgICAgICBsb2dzOiBbeyBsb2dnZWQ6IGxvZ2dlZCwgYnk6IGJ5IH1dLFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgIHJldHVybiByZXMuanNvbihbXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5qc29uKHJlc3VsdCk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBtb25nb1F1ZXJ5LmFkZExvZyhfaWQsIHtcclxuICAgICAgICAgICAgICBsb2dzOiBbeyBsb2dnZWQ6IGxvZ2dlZCwgYnk6IFwiQW5vbnltb3VzXCIgfV0sXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcy5qc29uKFtdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzLmpzb24ocmVzdWx0KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwibG9nIHJlcXVpcmVkXCIpO1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBlcnIubWVzc2FnZSB9KTtcclxuICAgICAgfVxyXG4gICAgY2FzZSBcIlBBVENIXCI6XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgeyBfaWQsIG5ld0lkLCBuZXdOYW1lIH0gPSBhd2FpdCByZXEuYm9keTtcclxuICAgICAgICBpZiAoX2lkKSB7XHJcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBtb25nb1F1ZXJ5LmVkaXRIeW1uKF9pZCwgbmV3SWQsIG5ld05hbWUpO1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5qc29uKHJlc3VsdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIklkIHJlcXVpcmVkXCIpO1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBlcnIubWVzc2FnZSB9KTtcclxuICAgICAgfVxyXG5cclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuc2VuZChcIk1ldGhvZCBOb3QgQWxsb3dlZFwiKTtcclxuICB9XHJcbn07XHJcbiIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcIm1vbmdvZGJcIik7Il0sIm5hbWVzIjpbIk1vbmdvQ2xpZW50IiwicmVxdWlyZSIsInVyaSIsInNldExvZ3MiLCJoeW1uSWQiLCJuZXdMb2dzIiwiY2xpZW50IiwiY29ubmVjdCIsInNldExvZyIsImRiIiwiY29sbGVjdGlvbiIsInVwZGF0ZU9uZSIsIl9pZCIsIiRzZXQiLCJsb2dzIiwiY29uc29sZSIsImxvZyIsImUiLCJlcnJvciIsImNsb3NlIiwiZ2V0QWxsSHltbnMiLCJyZXN1bHQiLCJsaXN0IiwiZmluZCIsIiRndGUiLCJ0b0FycmF5IiwiYWRkSHltbiIsIm5ld0h5bW4iLCJpbnNlcnRlZEh5bW4iLCJpbnNlcnRPbmUiLCJpbnNlcnRlZElkIiwibnVtYmVyIiwibmFtZSIsImVkaXRIeW1uIiwibmV3SWQiLCJuZXdOYW1lIiwib2xkSHltbiIsImZpbmRPbmUiLCJkZWxldGVPbmUiLCJuZXdIeW1ucyIsImNhdGNoIiwiYWRkTG9nIiwibmV3TG9nIiwiaHltbiIsImkiLCJsZW5ndGgiLCJsb2dnZWQiLCJwdXNoIiwiaW5zZXJ0ZWRMb2ciLCJtb2RpZmllZENvdW50IiwibW9kdWxlIiwiZXhwb3J0cyIsIm1vbmdvUXVlcnkiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJoeW1ucyIsInN0YXR1cyIsImpzb24iLCJlcnIiLCJtZXNzYWdlIiwiYm9keSIsImJ5IiwiRXJyb3IiLCJ1bmRlZmluZWQiLCJzZW5kIl0sInNvdXJjZVJvb3QiOiIifQ==